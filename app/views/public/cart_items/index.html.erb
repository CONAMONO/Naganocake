<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="">
	<title>カート</title>
</head>
<body>
	<% @total = 0 %>
	<% @tax = 1.10 %>
	<%= @error %>
	<div>
		<h3>ショッピングカート</h3>
		<%#= link_to "カートを空にする", public_cart_item_path, method: :delete %>
		<%= link_to "カートを空にする", '/public/cart_items/destroy', method: :delete, class: "btn btn-default"  %>
	</div>

	<div>
		<div>
			<table>
				<thead>
					<tr>
						<th>商品名</th>
						<th>単価</th>
						<th>数量</th>
						<th>小計</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<% @cart_items.each do |cart_item| %>
						<%= form_for(cart_item, url: public_cart_item_path(cart_item.id)) do |f| %>
							<tr>
								<td>
									<%= attachment_image_tag cart_item.product, :image, :fill, 300, 300, format: 'jpeg' %>
									<%= cart_item.product.name %>
								</td>
								<td>
									<%= (cart_item.product.non_taxed_price * @tax).floor %>
								</td>
								<td>
									<%# @cart_item = cart_item %>
									<%= f.text_field :quantity, value: cart_item.quantity %>
									<%= f.submit '変更', class: "btn btn-default" %>
								</td>
								<td>
									<%= ((cart_item.product.non_taxed_price * @tax) * cart_item.quantity).floor %>
									<%# binding.pry %>
									<% @total += ((cart_item.product.non_taxed_price * @tax) * cart_item.quantity).floor  %>
								</td>
								<td>
									<%#= link_to "Destroy", public_cart_item(cart_item.id), method: :delete, "data-confirm" => "本当に消しますか？" %>
									<%= link_to "削除する", public_cart_item_path(cart_item.id), method: :delete, class: "btn btn-default"  %>
								</td>
							<% end %>
						</tr>
					<% end %>
				</tbody>
			</table>

			<div>
				<%= link_to '買い物を続ける', root_path, class: "btn btn-default" %>
				<table>
					<tbody>
						<tr>
							<td>合計金額</td>
							<td><%= @total %></td>
						</tr>
					</tbody>
				</table>
			</div>

			<div>
				<%= link_to '情報入力に進む', new_public_order_path, class: "btn btn-default" %>
			</div>

		</div>
	</div>
</body>
</html>